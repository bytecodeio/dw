/bin/sh: /root/bin/segment-report-daily.sh: No such file or directory
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-06 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8480]
Committing the changes[2016-05-06 13:40:06]
End Time segment-report: [2016-05-06 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-07 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8400]
Committing the changes[2016-05-07 13:40:04]
End Time segment-report: [2016-05-07 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-08 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8367]
Committing the changes[2016-05-08 13:40:05]
End Time segment-report: [2016-05-08 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-09 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8270]
Committing the changes[2016-05-09 13:40:06]
End Time segment-report: [2016-05-09 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-10 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8113]
Committing the changes[2016-05-10 13:40:05]
End Time segment-report: [2016-05-10 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-11 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8133]
Committing the changes[2016-05-11 13:40:04]
End Time segment-report: [2016-05-11 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-12 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8384]
Committing the changes[2016-05-12 13:40:06]
End Time segment-report: [2016-05-12 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-13 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8458]
Committing the changes[2016-05-13 13:40:05]
End Time segment-report: [2016-05-13 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-14 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8398]
Committing the changes[2016-05-14 13:40:04]
End Time segment-report: [2016-05-14 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-15 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8421]
Committing the changes[2016-05-15 13:40:04]
End Time segment-report: [2016-05-15 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-16 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8829]
Committing the changes[2016-05-16 13:40:04]
End Time segment-report: [2016-05-16 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-17 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8964]
Committing the changes[2016-05-17 13:40:05]
End Time segment-report: [2016-05-17 13:40:07]
Report run time=[6] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-18 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[9071]
Committing the changes[2016-05-18 13:40:04]
End Time segment-report: [2016-05-18 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-19 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8791]
Committing the changes[2016-05-19 13:40:05]
End Time segment-report: [2016-05-19 13:40:07]
Report run time=[6] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-20 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8706]
Committing the changes[2016-05-20 13:40:05]
End Time segment-report: [2016-05-20 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-21 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8547]
Committing the changes[2016-05-21 13:40:05]
End Time segment-report: [2016-05-21 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-22 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8568]
Committing the changes[2016-05-22 13:40:04]
End Time segment-report: [2016-05-22 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-23 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8315]
Committing the changes[2016-05-23 13:40:04]
End Time segment-report: [2016-05-23 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-24 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[8103]
Committing the changes[2016-05-24 13:40:04]
End Time segment-report: [2016-05-24 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-25 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7847]
Committing the changes[2016-05-25 13:40:14]
End Time segment-report: [2016-05-25 13:40:15]
Report run time=[14] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-26 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7464]
Committing the changes[2016-05-26 13:40:05]
End Time segment-report: [2016-05-26 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-27 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6721]
Committing the changes[2016-05-27 13:40:04]
End Time segment-report: [2016-05-27 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-28 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6048]
Committing the changes[2016-05-28 13:40:04]
End Time segment-report: [2016-05-28 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-29 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5368]
Committing the changes[2016-05-29 13:40:05]
End Time segment-report: [2016-05-29 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-30 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4550]
Committing the changes[2016-05-30 13:40:05]
End Time segment-report: [2016-05-30 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-05-31 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3593]
Committing the changes[2016-05-31 13:40:05]
End Time segment-report: [2016-05-31 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-01 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[2294]
Committing the changes[2016-06-01 13:40:04]
End Time segment-report: [2016-06-01 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-02 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7158]
Committing the changes[2016-06-02 13:40:04]
End Time segment-report: [2016-06-02 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-03 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7163]
Committing the changes[2016-06-03 13:40:04]
End Time segment-report: [2016-06-03 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-04 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7179]
Committing the changes[2016-06-04 13:40:04]
End Time segment-report: [2016-06-04 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-05 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7193]
Committing the changes[2016-06-05 13:40:04]
End Time segment-report: [2016-06-05 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-06 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7250]
Committing the changes[2016-06-06 13:40:05]
End Time segment-report: [2016-06-06 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-07 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7166]
Committing the changes[2016-06-07 13:40:04]
End Time segment-report: [2016-06-07 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-08 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6907]
Committing the changes[2016-06-08 13:40:15]
End Time segment-report: [2016-06-08 13:40:16]
Report run time=[14] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-09 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6988]
Committing the changes[2016-06-09 13:40:04]
End Time segment-report: [2016-06-09 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-10 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7011]
Committing the changes[2016-06-10 13:40:04]
End Time segment-report: [2016-06-10 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-11 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7105]
Committing the changes[2016-06-11 13:40:03]
End Time segment-report: [2016-06-11 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-12 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7055]
Committing the changes[2016-06-12 13:40:04]
End Time segment-report: [2016-06-12 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-13 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7029]
Committing the changes[2016-06-13 13:40:05]
End Time segment-report: [2016-06-13 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-14 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6985]
Committing the changes[2016-06-14 13:40:04]
End Time segment-report: [2016-06-14 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-15 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[7016]
Committing the changes[2016-06-15 13:40:04]
End Time segment-report: [2016-06-15 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-16 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6930]
Committing the changes[2016-06-16 13:40:04]
End Time segment-report: [2016-06-16 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-17 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6974]
Committing the changes[2016-06-17 13:40:03]
End Time segment-report: [2016-06-17 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-18 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6830]
Committing the changes[2016-06-18 13:40:05]
End Time segment-report: [2016-06-18 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-19 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6770]
Committing the changes[2016-06-19 13:40:04]
End Time segment-report: [2016-06-19 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-20 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6768]
Committing the changes[2016-06-20 13:40:04]
End Time segment-report: [2016-06-20 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-21 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6754]
Committing the changes[2016-06-21 13:40:04]
End Time segment-report: [2016-06-21 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-22 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6659]
Committing the changes[2016-06-22 13:40:03]
End Time segment-report: [2016-06-22 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-23 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6566]
Committing the changes[2016-06-23 13:40:05]
End Time segment-report: [2016-06-23 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-24 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6490]
Committing the changes[2016-06-24 13:40:04]
End Time segment-report: [2016-06-24 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-25 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6279]
Committing the changes[2016-06-25 13:40:05]
End Time segment-report: [2016-06-25 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-26 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6362]
Committing the changes[2016-06-26 13:40:05]
End Time segment-report: [2016-06-26 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-27 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6394]
Committing the changes[2016-06-27 13:40:04]
End Time segment-report: [2016-06-27 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-28 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6375]
Committing the changes[2016-06-28 13:40:04]
End Time segment-report: [2016-06-28 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-29 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6328]
Committing the changes[2016-06-29 13:40:15]
End Time segment-report: [2016-06-29 13:40:16]
Report run time=[14] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-06-30 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6485]
Committing the changes[2016-06-30 13:40:04]
End Time segment-report: [2016-06-30 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-01 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6878]
Committing the changes[2016-07-01 13:40:06]
End Time segment-report: [2016-07-01 13:40:07]
Report run time=[6] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-02 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6852]
Committing the changes[2016-07-02 13:40:05]
End Time segment-report: [2016-07-02 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-03 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6802]
Committing the changes[2016-07-03 13:40:05]
End Time segment-report: [2016-07-03 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-04 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6852]
Committing the changes[2016-07-04 13:40:05]
End Time segment-report: [2016-07-04 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-05 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6759]
Committing the changes[2016-07-05 13:40:04]
End Time segment-report: [2016-07-05 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-06 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6745]
Committing the changes[2016-07-06 13:40:14]
End Time segment-report: [2016-07-06 13:40:16]
Report run time=[15] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-07 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6656]
Committing the changes[2016-07-07 13:40:04]
End Time segment-report: [2016-07-07 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-08 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6390]
Committing the changes[2016-07-08 13:40:05]
End Time segment-report: [2016-07-08 13:40:08]
Report run time=[6] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-09 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6118]
Committing the changes[2016-07-09 13:40:05]
End Time segment-report: [2016-07-09 13:40:07]
Report run time=[6] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-10 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6008]
Committing the changes[2016-07-10 13:40:06]
End Time segment-report: [2016-07-10 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-11 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6015]
Committing the changes[2016-07-11 13:40:05]
End Time segment-report: [2016-07-11 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-12 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6066]
Committing the changes[2016-07-12 13:40:03]
End Time segment-report: [2016-07-12 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-13 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5979]
Committing the changes[2016-07-13 13:40:05]
End Time segment-report: [2016-07-13 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-14 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6066]
Committing the changes[2016-07-14 13:40:05]
End Time segment-report: [2016-07-14 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-15 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[6099]
Committing the changes[2016-07-15 13:40:04]
End Time segment-report: [2016-07-15 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-16 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5958]
Committing the changes[2016-07-16 13:40:05]
End Time segment-report: [2016-07-16 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-17 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5968]
Committing the changes[2016-07-17 13:40:06]
End Time segment-report: [2016-07-17 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-18 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5951]
Committing the changes[2016-07-18 13:40:05]
End Time segment-report: [2016-07-18 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-19 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5689]
Committing the changes[2016-07-19 13:40:05]
End Time segment-report: [2016-07-19 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-20 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5896]
Committing the changes[2016-07-20 13:40:16]
End Time segment-report: [2016-07-20 13:40:17]
Report run time=[15] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-21 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5846]
Committing the changes[2016-07-21 13:40:06]
End Time segment-report: [2016-07-21 13:40:07]
Report run time=[6] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-22 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5758]
Committing the changes[2016-07-22 13:40:05]
End Time segment-report: [2016-07-22 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-23 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5698]
Committing the changes[2016-07-23 13:40:07]
End Time segment-report: [2016-07-23 13:40:08]
Report run time=[7] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-24 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5635]
Committing the changes[2016-07-24 13:40:06]
End Time segment-report: [2016-07-24 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-25 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5639]
Committing the changes[2016-07-25 13:40:06]
End Time segment-report: [2016-07-25 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-26 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5607]
Committing the changes[2016-07-26 13:40:06]
End Time segment-report: [2016-07-26 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-27 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5542]
Committing the changes[2016-07-27 13:40:17]
End Time segment-report: [2016-07-27 13:40:18]
Report run time=[16] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-28 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5338]
Committing the changes[2016-07-28 13:40:04]
End Time segment-report: [2016-07-28 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-29 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5476]
Committing the changes[2016-07-29 13:40:04]
End Time segment-report: [2016-07-29 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-30 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5389]
Committing the changes[2016-07-30 13:40:03]
End Time segment-report: [2016-07-30 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-07-31 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5449]
Committing the changes[2016-07-31 13:40:04]
End Time segment-report: [2016-07-31 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-01 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5480]
Committing the changes[2016-08-01 13:40:05]
End Time segment-report: [2016-08-01 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-02 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5478]
Committing the changes[2016-08-02 13:40:06]
End Time segment-report: [2016-08-02 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-03 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5428]
Committing the changes[2016-08-03 13:40:04]
End Time segment-report: [2016-08-03 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-04 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5369]
Committing the changes[2016-08-04 13:40:05]
End Time segment-report: [2016-08-04 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-05 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5368]
Committing the changes[2016-08-05 13:40:05]
End Time segment-report: [2016-08-05 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-06 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5257]
Committing the changes[2016-08-06 13:40:05]
End Time segment-report: [2016-08-06 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-07 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5225]
Committing the changes[2016-08-07 13:40:05]
End Time segment-report: [2016-08-07 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-08 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5190]
Committing the changes[2016-08-08 13:40:03]
End Time segment-report: [2016-08-08 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-09 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5081]
Committing the changes[2016-08-09 13:40:06]
End Time segment-report: [2016-08-09 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-10 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4944]
Committing the changes[2016-08-10 13:40:15]
End Time segment-report: [2016-08-10 13:40:15]
Report run time=[14] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-11 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5072]
Committing the changes[2016-08-11 13:40:05]
End Time segment-report: [2016-08-11 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-12 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5129]
Committing the changes[2016-08-12 13:40:05]
End Time segment-report: [2016-08-12 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-13 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5034]
Committing the changes[2016-08-13 13:40:04]
End Time segment-report: [2016-08-13 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-14 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5070]
Committing the changes[2016-08-14 13:40:04]
End Time segment-report: [2016-08-14 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-15 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5079]
Committing the changes[2016-08-15 13:40:05]
End Time segment-report: [2016-08-15 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-16 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5142]
Committing the changes[2016-08-16 13:40:05]
End Time segment-report: [2016-08-16 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-17 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5197]
Committing the changes[2016-08-17 13:40:17]
End Time segment-report: [2016-08-17 13:40:18]
Report run time=[17] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-18 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5163]
Committing the changes[2016-08-18 13:40:05]
End Time segment-report: [2016-08-18 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-19 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5202]
Committing the changes[2016-08-19 13:40:05]
End Time segment-report: [2016-08-19 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-20 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5321]
Committing the changes[2016-08-20 13:40:06]
End Time segment-report: [2016-08-20 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-21 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5359]
Committing the changes[2016-08-21 13:40:04]
End Time segment-report: [2016-08-21 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-22 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5421]
Committing the changes[2016-08-22 13:40:07]
End Time segment-report: [2016-08-22 13:40:08]
Report run time=[6] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-23 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5404]
Committing the changes[2016-08-23 13:40:03]
End Time segment-report: [2016-08-23 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-24 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5312]
Committing the changes[2016-08-24 13:40:05]
End Time segment-report: [2016-08-24 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-25 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5299]
Committing the changes[2016-08-25 13:40:06]
End Time segment-report: [2016-08-25 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-26 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5284]
Committing the changes[2016-08-26 13:40:04]
End Time segment-report: [2016-08-26 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-27 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5058]
Committing the changes[2016-08-27 13:40:03]
End Time segment-report: [2016-08-27 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-28 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[5009]
Committing the changes[2016-08-28 13:40:05]
End Time segment-report: [2016-08-28 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-29 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4877]
Committing the changes[2016-08-29 13:40:06]
End Time segment-report: [2016-08-29 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-30 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4744]
Committing the changes[2016-08-30 13:40:04]
End Time segment-report: [2016-08-30 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-08-31 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4713]
Committing the changes[2016-08-31 13:40:15]
End Time segment-report: [2016-08-31 13:40:15]
Report run time=[14] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-01 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4665]
Committing the changes[2016-09-01 13:40:03]
End Time segment-report: [2016-09-01 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-02 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4671]
Committing the changes[2016-09-02 13:40:04]
End Time segment-report: [2016-09-02 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-03 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4711]
Committing the changes[2016-09-03 13:40:03]
End Time segment-report: [2016-09-03 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-04 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4691]
Committing the changes[2016-09-04 13:40:04]
End Time segment-report: [2016-09-04 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-05 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4662]
Committing the changes[2016-09-05 13:40:04]
End Time segment-report: [2016-09-05 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-06 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4662]
Committing the changes[2016-09-06 13:40:05]
End Time segment-report: [2016-09-06 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-07 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4635]
Committing the changes[2016-09-07 13:40:05]
End Time segment-report: [2016-09-07 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-08 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4610]
Committing the changes[2016-09-08 13:40:06]
End Time segment-report: [2016-09-08 13:40:07]
Report run time=[6] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-09 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4626]
Committing the changes[2016-09-09 13:40:05]
End Time segment-report: [2016-09-09 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-10 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4484]
Committing the changes[2016-09-10 13:40:05]
End Time segment-report: [2016-09-10 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-11 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4451]
Committing the changes[2016-09-11 13:40:05]
End Time segment-report: [2016-09-11 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-12 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4485]
Committing the changes[2016-09-12 13:40:05]
End Time segment-report: [2016-09-12 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-13 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4474]
Committing the changes[2016-09-13 13:40:04]
End Time segment-report: [2016-09-13 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-14 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4418]
Committing the changes[2016-09-14 13:40:15]
End Time segment-report: [2016-09-14 13:40:16]
Report run time=[15] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-15 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4404]
Committing the changes[2016-09-15 13:40:05]
End Time segment-report: [2016-09-15 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-16 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4341]
Committing the changes[2016-09-16 13:40:05]
End Time segment-report: [2016-09-16 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-17 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4293]
Committing the changes[2016-09-17 13:40:03]
End Time segment-report: [2016-09-17 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-18 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4340]
Committing the changes[2016-09-18 13:40:04]
End Time segment-report: [2016-09-18 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-19 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4391]
Committing the changes[2016-09-19 13:40:05]
End Time segment-report: [2016-09-19 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-20 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4431]
Committing the changes[2016-09-20 13:40:03]
End Time segment-report: [2016-09-20 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-21 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4434]
Committing the changes[2016-09-21 13:40:05]
End Time segment-report: [2016-09-21 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-22 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4417]
Committing the changes[2016-09-22 13:40:04]
End Time segment-report: [2016-09-22 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-23 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4427]
Committing the changes[2016-09-23 13:40:04]
End Time segment-report: [2016-09-23 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-24 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4414]
Committing the changes[2016-09-24 13:40:04]
End Time segment-report: [2016-09-24 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-25 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4388]
Committing the changes[2016-09-25 13:40:05]
End Time segment-report: [2016-09-25 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-26 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4380]
Committing the changes[2016-09-26 13:40:04]
End Time segment-report: [2016-09-26 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-27 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4368]
Committing the changes[2016-09-27 13:40:05]
End Time segment-report: [2016-09-27 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-28 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4331]
Committing the changes[2016-09-28 13:40:16]
End Time segment-report: [2016-09-28 13:40:17]
Report run time=[15] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-29 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4353]
Committing the changes[2016-09-29 13:40:04]
End Time segment-report: [2016-09-29 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-09-30 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4437]
Committing the changes[2016-09-30 13:40:06]
End Time segment-report: [2016-09-30 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-01 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4630]
Committing the changes[2016-10-01 13:40:05]
End Time segment-report: [2016-10-01 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-02 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4658]
Committing the changes[2016-10-02 13:40:05]
End Time segment-report: [2016-10-02 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-03 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4692]
Committing the changes[2016-10-03 13:40:03]
End Time segment-report: [2016-10-03 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-04 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4631]
Committing the changes[2016-10-04 13:40:05]
End Time segment-report: [2016-10-04 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-05 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4652]
Committing the changes[2016-10-05 13:40:05]
End Time segment-report: [2016-10-05 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-06 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4586]
Committing the changes[2016-10-06 13:40:05]
End Time segment-report: [2016-10-06 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-07 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4612]
Committing the changes[2016-10-07 13:40:05]
End Time segment-report: [2016-10-07 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-08 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4480]
Committing the changes[2016-10-08 13:40:04]
End Time segment-report: [2016-10-08 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-09 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4401]
Committing the changes[2016-10-09 13:40:03]
End Time segment-report: [2016-10-09 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-10 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4398]
Committing the changes[2016-10-10 13:40:04]
End Time segment-report: [2016-10-10 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-11 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4375]
Committing the changes[2016-10-11 13:40:04]
End Time segment-report: [2016-10-11 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-12 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4441]
Committing the changes[2016-10-12 13:40:16]
End Time segment-report: [2016-10-12 13:40:17]
Report run time=[15] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-13 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4632]
Committing the changes[2016-10-13 13:40:04]
End Time segment-report: [2016-10-13 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-14 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4715]
Committing the changes[2016-10-14 13:40:06]
End Time segment-report: [2016-10-14 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-15 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4627]
Committing the changes[2016-10-15 13:40:03]
End Time segment-report: [2016-10-15 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-16 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4609]
Committing the changes[2016-10-16 13:40:03]
End Time segment-report: [2016-10-16 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-17 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4565]
Committing the changes[2016-10-17 13:40:03]
End Time segment-report: [2016-10-17 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-18 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4530]
Committing the changes[2016-10-18 13:40:04]
End Time segment-report: [2016-10-18 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-19 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4515]
Committing the changes[2016-10-19 13:40:04]
End Time segment-report: [2016-10-19 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-20 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4300]
Committing the changes[2016-10-20 13:40:04]
End Time segment-report: [2016-10-20 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-21 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4394]
Committing the changes[2016-10-21 13:40:05]
End Time segment-report: [2016-10-21 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-22 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4352]
Committing the changes[2016-10-22 13:40:04]
End Time segment-report: [2016-10-22 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-23 13:40:03]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4314]
Committing the changes[2016-10-23 13:40:06]
End Time segment-report: [2016-10-23 13:40:07]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-24 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4251]
Committing the changes[2016-10-24 13:40:05]
End Time segment-report: [2016-10-24 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-25 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4191]
Committing the changes[2016-10-25 13:40:05]
End Time segment-report: [2016-10-25 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-26 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[4092]
Committing the changes[2016-10-26 13:40:15]
End Time segment-report: [2016-10-26 13:40:16]
Report run time=[14] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-27 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3975]
Committing the changes[2016-10-27 13:40:04]
End Time segment-report: [2016-10-27 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-28 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3903]
Committing the changes[2016-10-28 13:40:03]
End Time segment-report: [2016-10-28 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-29 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3808]
Committing the changes[2016-10-29 13:40:05]
End Time segment-report: [2016-10-29 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-30 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3715]
Committing the changes[2016-10-30 13:40:04]
End Time segment-report: [2016-10-30 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-10-31 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3681]
Committing the changes[2016-10-31 13:40:04]
End Time segment-report: [2016-10-31 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-01 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3609]
Committing the changes[2016-11-01 13:40:04]
End Time segment-report: [2016-11-01 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-02 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3557]
Committing the changes[2016-11-02 13:40:05]
End Time segment-report: [2016-11-02 13:40:06]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-03 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3518]
Committing the changes[2016-11-03 13:40:04]
End Time segment-report: [2016-11-03 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-04 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3481]
Committing the changes[2016-11-04 13:40:04]
End Time segment-report: [2016-11-04 13:40:04]
Report run time=[2] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-05 13:40:03]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3620]
Committing the changes[2016-11-05 13:40:05]
End Time segment-report: [2016-11-05 13:40:06]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-06 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3818]
Committing the changes[2016-11-06 13:40:03]
End Time segment-report: [2016-11-06 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-07 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3881]
Committing the changes[2016-11-07 13:40:06]
End Time segment-report: [2016-11-07 13:40:07]
Report run time=[5] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-08 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3883]
Committing the changes[2016-11-08 13:40:04]
End Time segment-report: [2016-11-08 13:40:05]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-09 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3878]
Committing the changes[2016-11-09 13:40:16]
End Time segment-report: [2016-11-09 13:40:17]
Report run time=[15] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-10 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3825]
Committing the changes[2016-11-10 13:40:09]
End Time segment-report: [2016-11-10 13:40:09]
Report run time=[7] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-11 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3763]
Committing the changes[2016-11-11 13:40:03]
End Time segment-report: [2016-11-11 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-12 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3727]
Committing the changes[2016-11-12 13:40:05]
End Time segment-report: [2016-11-12 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-13 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3203]
Committing the changes[2016-11-13 13:40:04]
End Time segment-report: [2016-11-13 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-14 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[3020]
Committing the changes[2016-11-14 13:40:05]
End Time segment-report: [2016-11-14 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-15 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[2854]
Committing the changes[2016-11-15 13:40:03]
End Time segment-report: [2016-11-15 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-16 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[2694]
Committing the changes[2016-11-16 13:40:04]
End Time segment-report: [2016-11-16 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-17 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[2546]
Committing the changes[2016-11-17 13:40:05]
End Time segment-report: [2016-11-17 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-18 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[2419]
Committing the changes[2016-11-18 13:40:03]
End Time segment-report: [2016-11-18 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-19 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[2303]
Committing the changes[2016-11-19 13:40:04]
End Time segment-report: [2016-11-19 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-20 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[2207]
Committing the changes[2016-11-20 13:40:05]
End Time segment-report: [2016-11-20 13:40:05]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-21 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[2136]
Committing the changes[2016-11-21 13:40:03]
End Time segment-report: [2016-11-21 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-22 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[2022]
Committing the changes[2016-11-22 13:40:06]
End Time segment-report: [2016-11-22 13:40:06]
Report run time=[4] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-23 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[1956]
Committing the changes[2016-11-23 13:40:15]
End Time segment-report: [2016-11-23 13:40:16]
Report run time=[14] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-24 13:40:02]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[1741]
Committing the changes[2016-11-24 13:40:04]
End Time segment-report: [2016-11-24 13:40:04]
Report run time=[2] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-25 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[1529]
Committing the changes[2016-11-25 13:40:03]
End Time segment-report: [2016-11-25 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-26 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[1296]
Committing the changes[2016-11-26 13:40:03]
End Time segment-report: [2016-11-26 13:40:04]
Report run time=[3] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-27 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[1069]
Committing the changes[2016-11-27 13:40:03]
End Time segment-report: [2016-11-27 13:40:03]
Report run time=[2] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
Start Time segment-report: [2016-11-28 13:40:03]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
Number of users inserted=[812]
Committing the changes[2016-11-28 13:40:05]
End Time segment-report: [2016-11-28 13:40:05]
Report run time=[2] seconds
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
/usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/adapters/postgres.rb:243:in `initialize': PG::ConnectionBad: could not translate host name "analytics.c1szeu5viq2r.us-east-1.redshift.amazonaws.com" to address: Name or service not known (Sequel::DatabaseConnectionError)
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/adapters/postgres.rb:243:in `new'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/adapters/postgres.rb:243:in `connect'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool.rb:103:in `make_new'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:224:in `make_new'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:197:in `available'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:133:in `_acquire'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:147:in `block in acquire'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:265:in `block in sync'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:265:in `synchronize'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:265:in `sync'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:146:in `acquire'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:104:in `hold'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/database/connecting.rb:251:in `synchronize'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/adapters/postgres.rb:342:in `execute'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/dataset/actions.rb:952:in `execute'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/adapters/postgres.rb:670:in `fetch_rows'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/dataset/actions.rb:141:in `each'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/database/dataset.rb:48:in `fetch'
	from /root/management-report/lib/sql_job.rb:35:in `run'
	from ./segment-report:43:in `process_users'
	from ./segment-report:32:in `runner'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/thor-0.19.1/lib/thor/command.rb:27:in `run'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/thor-0.19.1/lib/thor/invocation.rb:126:in `invoke_command'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/thor-0.19.1/lib/thor.rb:359:in `dispatch'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/thor-0.19.1/lib/thor/base.rb:440:in `start'
	from ./segment-report:90:in `<main>'
Start Time segment-report: [2016-11-29 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
./segment-report:12: warning: already initialized constant OpenSSL::SSL::VERIFY_PEER
/usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/adapters/postgres.rb:243:in `initialize': PG::ConnectionBad: could not translate host name "analytics.c1szeu5viq2r.us-east-1.redshift.amazonaws.com" to address: Name or service not known (Sequel::DatabaseConnectionError)
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/adapters/postgres.rb:243:in `new'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/adapters/postgres.rb:243:in `connect'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool.rb:103:in `make_new'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:224:in `make_new'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:197:in `available'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:133:in `_acquire'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:147:in `block in acquire'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:265:in `block in sync'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:265:in `synchronize'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:265:in `sync'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:146:in `acquire'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/connection_pool/threaded.rb:104:in `hold'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/database/connecting.rb:251:in `synchronize'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/adapters/postgres.rb:342:in `execute'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/dataset/actions.rb:952:in `execute'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/adapters/postgres.rb:670:in `fetch_rows'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/dataset/actions.rb:141:in `each'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/sequel-4.31.0/lib/sequel/database/dataset.rb:48:in `fetch'
	from /root/management-report/lib/sql_job.rb:35:in `run'
	from ./segment-report:43:in `process_users'
	from ./segment-report:32:in `runner'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/thor-0.19.1/lib/thor/command.rb:27:in `run'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/thor-0.19.1/lib/thor/invocation.rb:126:in `invoke_command'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/thor-0.19.1/lib/thor.rb:359:in `dispatch'
	from /usr/local/rvm/gems/ruby-2.2.1/gems/thor-0.19.1/lib/thor/base.rb:440:in `start'
	from ./segment-report:90:in `<main>'
Start Time segment-report: [2016-11-30 13:40:01]
Connect to Segment
Load Appboy SQL 
fullpath: /root/management-report/sql/spreadsheet/segment/appboy_users.sql
Process users 

-- All users who visited in last 7 days
WITH recent_users AS
( 
SELECT id AS user_id
  FROM yerdle_users 
 WHERE last_visit >= CURRENT_DATE - '7 days'::INTERVAL 
),
-- Get the data to be sent to Segment
all_users_data AS 
(
SELECT x.user_id              AS user_id, 
       MAX(x.last_login_date) AS last_login_date,
       MAX(x.last_claim_date) AS last_claim_date ,
       MAX(x.last_given_date) AS last_given_date,
       MAX(x.claims_count)    AS claims_count,
       MAX(x.given_count)     AS given_count
FROM ( 
SELECT id         AS user_id,
       updated_at AS last_login_date,
       NULL       AS last_claim_date,
       NULL       AS last_given_date,
       0          AS claims_count,
       0          AS given_count 
  FROM yerdle_users
UNION ALL
SELECT
       claimer_id                 AS user_id,
       NULL                       AS last_login_date,
       MAX(created_at)            AS last_claim_date,
       NULL                       AS last_given_date,
       COUNT(distinct posting_id) AS claims_count,
       0                          AS given_count
 FROM yerdle_posting_transitions 
WHERE
      created_at >= '2015-01-01' AND created_at < CURRENT_DATE
  AND to_state in ('claimed')
GROUP BY claimer_id
UNION ALL
SELECT
       p.poster_id          AS user_id,
       NULL                 AS last_login_date,    
       NULL                 AS last_claim_date,    
       MAX(pt.created_at)   AS last_given_date,
       0                    AS claims_count,
       COUNT(distinct p.id) AS given_count
  FROM 
       yerdle_posting_transitions pt
  JOIN yerdle_postings p 
    ON p.id = pt.posting_id
WHERE
      pt.created_at >= '2015-01-01' AND pt.created_at < CURRENT_DATE
  AND pt.to_state in ('claimed')
GROUP BY p.poster_id
)  X 
GROUP BY x.user_id
)
-- Convert dates to strings(ISO 8601 format) to be used in JSON 
SELECT d.user_id, 
       u.first_name || ' ' || u.last_name user_name,
       u.first_name || ' ' || u.last_name user_name,
       TO_CHAR(d.last_login_date, 'YYYY-MM-DD HH24:MI:SS') last_login_date,
       TO_CHAR(d.last_claim_date, 'YYYY-MM-DD HH24:MI:SS') last_claim_date,
       TO_CHAR(d.last_given_date, 'YYYY-MM-DD HH24:MI:SS') last_given_date,
       d.claims_count,
       d.given_count
  FROM recent_users r 
  JOIN all_users_data d 
    ON r.user_id = d.user_id
  JOIN yerdle_users u 
    ON u.id = r.user_id
 ORDER BY 1
